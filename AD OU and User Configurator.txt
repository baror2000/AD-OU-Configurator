$NewOU = Read-Host "Please enter New OU Name"
$UserCount = Read-Host "Please enter number of new users in the new OU"
$Path = "OU=$NewOU,DC=kernel,DC=com" 
$Nickname = $NewOU.Substring(0,3)

##### Procces Check ####
function ProcessCheck {
    if ($?) {
        Write-Host "Successuf"
    }
    else {
        Write-Host "Failed"
    }
}

##### OU Configuration #######
function OUConfiguration {
    New-ADOrganizationalUnit -Name "$NewOU" -Path "DC=kernel,DC=com"
    write-host "OU Creation" ProcessCheck

    New-ADOrganizationalUnit -Name "Computers" -Path "$Path"
    write-host "Computer OU Creation" ProcessCheck

    
    New-ADOrganizationalUnit -Name "Users" -Path "$Path"
    for ($i=1; $i -le $UserCount; $i++) {
        New-ADUser -Path "OU=Users, $Path" -Name "$Nickname-User$i" -SamAccountName "$Nickname-User$i" -UserPrincipalName "$Nickname-User$i" -AccountPassword (ConvertTo-SecureString "qwer4321!" -AsPlainText -Force) -Enabled $true
    } 
    write-host "User OU Creation" ProcessCheck

    New-ADOrganizationalUnit -Name "Groups" -Path "$Path"
    New-ADGroup -path "OU=Groups, $Path" -name "$NewOU" -SamAccountName "$NewOU" -GroupCategory Security -GroupScope Global -DisplayName "$NewOU Group"
    for ($i=1; $i -le $UserCount; $i++) {
        Add-ADGroupMember -Identity $NewOU -Members "$Nickname-User$i" 
    }
    write-host "Group OU Creation" ProcessCheck

}

OUConfiguration